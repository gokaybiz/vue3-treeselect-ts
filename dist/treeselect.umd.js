(function(F,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("lodash")):typeof define=="function"&&define.amd?define(["exports","vue","lodash"],e):(F=typeof globalThis<"u"?globalThis:F||self,e(F["vue-treeselect"]={},F.Vue,F.lodash))})(this,function(F,e,z){"use strict";var Nn=Object.defineProperty;var Cn=(F,e,z)=>e in F?Nn(F,e,{enumerable:!0,configurable:!0,writable:!0,value:z}):F[e]=z;var W=(F,e,z)=>(Cn(F,typeof e!="symbol"?e+"":e,z),z);const K=Symbol("instance");function Y(n,t){const o=e.inject(n,t);if(!o)throw new Error(`Could not resolve ${n.description}`);return o}const Je=["name","value"],Ze=e.defineComponent({__name:"TreeselectHiddenFields",setup(n){const t=Y(K),o=e.computed(()=>!t.props.name||t.props.disabled||!t.hasValue.value),a=e.computed(()=>{let l=t.internalValue.value.map(p=>typeof p=="string"?p:p!=null&&!isNaN(p)?JSON.stringify(p):"");return t.props.multiple&&t.props.joinValues&&(l=[l.join(t.props.delimiter)]),l});return(l,p)=>o.value?e.createCommentVNode("",!0):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(a.value,(m,_)=>(e.openBlock(),e.createElementBlock("input",{key:`hidden-field-${_}`,type:"hidden",name:e.unref(t).props.name,value:m},null,8,Je))),128))}});function be(n){return!!n&&(typeof n=="object"||typeof n=="function")&&typeof n.then=="function"}const ve=e.defineComponent({name:"VueTreeselectX"}),ye=(n,t)=>{const o=n.__vccOpts||n;for(const[a,l]of t)o[a]=l;return o},et={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 348.333 348.333"},tt=[e.createElementVNode("path",{d:"M336.559 68.611L231.016 174.165l105.543 105.549c15.699 15.705 15.699 41.145 0 56.85-7.844 7.844-18.128 11.769-28.407 11.769-10.296 0-20.581-3.919-28.419-11.769L174.167 231.003 68.609 336.563c-7.843 7.844-18.128 11.769-28.416 11.769-10.285 0-20.563-3.919-28.413-11.769-15.699-15.698-15.699-41.139 0-56.85l105.54-105.549L11.774 68.611c-15.699-15.699-15.699-41.145 0-56.844 15.696-15.687 41.127-15.687 56.829 0l105.563 105.554L279.721 11.767c15.705-15.687 41.139-15.687 56.832 0 15.705 15.699 15.705 41.145.006 56.844z"},null,-1)];function nt(n,t,o,a,l,p){return e.openBlock(),e.createElementBlock("svg",et,tt)}const xe=ye(ve,[["render",nt]]),ot=e.defineComponent({name:"VueTreeselectArrow"}),lt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 292.362 292.362"},st=[e.createElementVNode("path",{d:"M286.935 69.377c-3.614-3.617-7.898-5.424-12.848-5.424H18.274c-4.952 0-9.233 1.807-12.85 5.424C1.807 72.998 0 77.279 0 82.228c0 4.948 1.807 9.229 5.424 12.847l127.907 127.907c3.621 3.617 7.902 5.428 12.85 5.428s9.233-1.811 12.847-5.428L286.935 95.074c3.613-3.617 5.427-7.898 5.427-12.847 0-4.948-1.814-9.229-5.427-12.85z"},null,-1)];function rt(n,t,o,a,l,p){return e.openBlock(),e.createElementBlock("svg",lt,st)}const De=ye(ot,[["render",rt]]),le=e.defineComponent({props:{slotFunction:{type:[Function],required:!0},slotObject:{type:[Object],default:void 0}},render(){return this.slotObject?this.slotFunction(this.slotObject):this.slotFunction()}}),at={class:"vue-treeselect__multi-value-item-container"},it={class:"vue-treeselect__multi-value-label"},ct={class:"vue-treeselect__icon vue-treeselect__value-remove"},dt=e.defineComponent({__name:"TreeselectMultiValueItem",props:{node:{type:Object,required:!0}},setup(n){const t=n,{node:o}=e.toRefs(t),a=Y(K),l=e.computed(()=>({"vue-treeselect__multi-value-item":!0,"vue-treeselect__multi-value-item-disabled":o.value.isDisabled,"vue-treeselect__multi-value-item-new":o.value.isNew})),p=()=>{a.select(o.value)},m=e.computed(()=>a.customValueLabelRenderer);return(_,E)=>(e.openBlock(),e.createElementBlock("div",at,[e.createElementVNode("div",{class:e.normalizeClass(l.value),onMousedown:e.withModifiers(p,["left"])},[e.createElementVNode("span",it,[m.value?(e.openBlock(),e.createBlock(le,{key:0,"slot-function":m.value,"slot-object":{node:e.unref(o)}},null,8,["slot-function","slot-object"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createTextVNode(e.toDisplayString(e.unref(o).label),1)],64))]),e.createElementVNode("span",ct,[e.createVNode(xe)])],34)]))}}),ut={},pt={class:"vue-treeselect__value-container"};function ft(n,t){return e.openBlock(),e.createElementBlock("div",pt,[e.renderSlot(n.$slots,"default")])}const Le=ye(ut,[["render",ft]]),J=null,ge=0,Ve=1,Te=2,v="ALL_CHILDREN",se="ALL_DESCENDANTS",re="LEAF_CHILDREN",ae="LEAF_DESCENDANTS",Me="LOAD_ROOT_OPTIONS",Re="LOAD_CHILDREN_OPTIONS",Ae="ASYNC_SEARCH",Ee="ALL",fe="BRANCH_PRIORITY",ke="LEAF_PRIORITY",Be="ALL_WITH_INDETERMINATE",Ie="ORDER_SELECTED",$e="LEVEL",Fe="INDEX",H={BACKSPACE:8,ENTER:13,ESCAPE:27,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46},ht=process.env.NODE_ENV==="testing"?10:200,ze=5,He=40,mt=["tabIndex","required","value"],_t=[H.ENTER,H.END,H.HOME,H.ARROW_LEFT,H.ARROW_UP,H.ARROW_RIGHT,H.ARROW_DOWN,"Enter","End","Home","ArrowLeft","ArrowUp","ArrowRight","ArrowDown"],Pe=e.defineComponent({__name:"TreeselectInput",setup(n,{expose:t}){const o=e.ref(ze),a=e.ref(""),l=Y(K),p=()=>{l.trigger.searchQuery=a.value},m=z.debounce(p,ht,{leading:!0,trailing:!0}),_=()=>{l.trigger.isFocused=!0,l.props.openOnFocus&&l.openMenu()},E=e.ref(),D=()=>{var c;l.props.disabled||E.value&&((c=E.value)==null||c.focus())},N=()=>{E.value&&E.value.blur()},C=()=>{const c=l.getMenuDiv();if(c&&document.activeElement===c)return D();l.trigger.isFocused=!1,l.closeMenu()},b=c=>{const w=c.target.value;a.value=w,a.value?m():(m.cancel(),p())},V=c=>{const w=c.key?c.key:c.keyCode;if(c.ctrlKey||c.shiftKey||c.altKey||c.metaKey)return;if(!l.menu.isOpen&&_t.includes(w))return c.preventDefault(),l.openMenu();const y=()=>{l.props.backspaceRemoves&&!a.value.length&&l.removeLastValue()},O=()=>{if(c.preventDefault(),l.menu.current===null)return;const g=l.getNode(l.menu.current);if(g){if(g.isBranch&&l.props.disableBranchNodes)return;l.select(g)}},A=()=>{a.value.length?b({target:{value:""}}):l.menu.isOpen&&l.closeMenu()},P=()=>{c.preventDefault(),l.highlightLastOption()},Q=()=>{c.preventDefault(),l.highlightFirstOption()},X=()=>{const g=l.getNode(l.menu.current);g&&(g.isBranch&&l.shouldExpand(g)?(c.preventDefault(),l.toggleExpanded(g)):!g.isRootNode&&(g.isLeaf||g.isBranch&&!l.shouldExpand(g))&&(c.preventDefault(),g.parentNode&&l.setCurrentHighlightedOption(g.parentNode)))},s=()=>{c.preventDefault(),l.highlightPrevOption()},u=()=>{const g=l.getNode(l.menu.current);g&&g.isBranch&&!l.shouldExpand(g)&&(c.preventDefault(),l.toggleExpanded(g))},L=()=>{c.preventDefault(),l.highlightNextOption()},k=()=>{l.props.deleteRemoves&&!a.value.length&&l.removeLastValue()},r=new Map;r.set(H.BACKSPACE,y),r.set("Backspace",y),r.set(H.ENTER,O),r.set("Enter",O),r.set(H.ESCAPE,A),r.set("Escape",A),r.set(H.END,P),r.set("End",P),r.set(H.HOME,Q),r.set("Home",Q),r.set(H.ARROW_LEFT,X),r.set("ArrowLeft",X),r.set(H.ARROW_UP,s),r.set("ArrowUp",s),r.set(H.ARROW_RIGHT,u),r.set("ArrowRight",u),r.set(H.ARROW_DOWN,L),r.set("ArrowDown",L),r.set(H.DELETE,k),r.set("Delete",k),(r.get(w)||l.openMenu)()},f=()=>{let c={};return l.props.searchable||(c={on:{focus:_,blur:C,keydown:V},ref:"input"},l.props.disabled||(c={...c,attrs:{tabIndex:l.props.tabIndex}})),c},h=e.computed(()=>l.props.searchable&&!l.props.disabled&&l.props.multiple),i=c=>{a.value.length&&c.stopPropagation()};t({blur:N,focus:D});const d=e.ref();return e.watch(()=>l.trigger.searchQuery,c=>{a.value=c,h.value&&e.nextTick(()=>{var w;d.value&&(o.value=Math.max(ze,((w=d.value)==null?void 0:w.scrollWidth)+15))})},{flush:"post"}),(c,w)=>(e.openBlock(),e.createElementBlock("div",e.mergeProps({class:"vue-treeselect__input-container"},f()),[e.unref(l).props.searchable&&!e.unref(l).props.disabled?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("input",{ref_key:"input",ref:E,class:"vue-treeselect__input",type:"text",autocomplete:"off",tabIndex:e.unref(l).props.tabIndex,required:e.unref(l).props.required&&!e.unref(l).hasValue.value,value:a.value,style:e.normalizeStyle(h.value?`width:${o.value}px`:""),onFocus:_,onInput:b,onBlur:C,onKeydown:V,onMousedown:i},null,44,mt),h.value?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"sizer",ref:d,class:"vue-treeselect__sizer"},e.toDisplayString(a.value),513)):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)],16))}}),We=e.defineComponent({__name:"TreeselectPlaceholder",setup(n){const t=Y(K),o=e.computed(()=>({"vue-treeselect__placeholder":!0,"vue-treeselect-helper-zoom-effect-off":!0,"vue-treeselect-helper-hide":t.hasValue.value||t.trigger.searchQuery}));return(a,l)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(o.value)},e.toDisplayString(e.unref(t).props.placeholder),3))}}),yt={key:"exceed-limit-tip",class:"vue-treeselect__limit-tip vue-treeselect-helper-zoom-effect-off"},gt={class:"vue-treeselect__limit-tip-text"},Et=e.defineComponent({__name:"TreeselectMultiValue",setup(n){const t=Y(K),o=e.computed(()=>t.internalValue.value.length-t.props.limit),a=e.computed(()=>t.internalValue.value.slice(0,t.props.limit).map(t.getNode).filter(l=>l!=null));return(l,p)=>(e.openBlock(),e.createBlock(Le,null,{default:e.withCtx(()=>[e.createVNode(e.TransitionGroup,{class:"vue-treeselect__multi-value",tag:"div",name:"vue-treeselect__multi-value-item--transition",appear:!0},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,m=>(e.openBlock(),e.createBlock(dt,{key:`multi-value-item-${m.id}`,node:m},null,8,["node"]))),128)),o.value>0?(e.openBlock(),e.createElementBlock("div",yt,[e.createElementVNode("span",gt,e.toDisplayString(e.unref(t).props.limitText(o.value)),1)])):e.createCommentVNode("",!0),e.createVNode(We,{key:"placeholder"}),e.createVNode(Pe,{ref:"input",key:"input"},null,512)]),_:1})]),_:1}))}}),kt={key:0,class:"vue-treeselect__single-value"},Bt=e.defineComponent({__name:"TreeselectSingleValue",setup(n){const t=Y(K),o=e.computed(()=>t.hasValue.value&&!t.trigger.searchQuery),a=e.computed(()=>t.customValueLabelRenderer),l=e.computed(()=>t.selectedNodes.value[0]);return(p,m)=>(e.openBlock(),e.createBlock(Le,null,{default:e.withCtx(()=>[o.value?(e.openBlock(),e.createElementBlock("div",kt,[a.value?(e.openBlock(),e.createBlock(le,{key:0,"slot-function":a.value,"slot-object":{node:l.value}},null,8,["slot-function","slot-object"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createTextVNode(e.toDisplayString(l.value.label),1)],64))])):e.createCommentVNode("",!0),e.createVNode(We),e.createVNode(Pe,{ref:"input"},null,512)]),_:1}))}}),Ot=["title"],wt=e.defineComponent({__name:"TreeselectControl",setup(n){const t=Y(K),o=e.computed(()=>t.props.clearable&&!t.props.disabled&&t.hasValue.value&&(t.hasValue.value&&t.internalValue.value.some(m=>{var _;return!((_=t.getNode(m))!=null&&_.isDisabled)})||t.props.allowClearingDisabled)),a=e.computed(()=>t.props.alwaysOpen?!t.menu.isOpen:!0),l=()=>{const m=t.props.beforeClearAll(),_=E=>{E&&t.clear()};be(m)?m.then(_):setTimeout(()=>_(m),0)},p=()=>{t.focusInput(),t.toggleMenu()};return(m,_)=>(e.openBlock(),e.createElementBlock("div",{class:"vue-treeselect__control",onMousedown:_[0]||(_[0]=e.withModifiers((...E)=>e.unref(t).handleMouseDown&&e.unref(t).handleMouseDown(...E),["left","stop","prevent"]))},[e.unref(t).props.multiple?(e.openBlock(),e.createBlock(Et,{key:1,ref:"value-container"},null,512)):(e.openBlock(),e.createBlock(Bt,{key:0,ref:"value-container"},null,512)),o.value?(e.openBlock(),e.createElementBlock("div",{key:2,class:"vue-treeselect__x-container",title:e.unref(t).props.multiple?e.unref(t).props.clearAllText:e.unref(t).props.clearValueText,onMousedown:e.withModifiers(l,["left","stop","prevent"])},[e.createVNode(xe,{class:"vue-treeselect__x"})],40,Ot)):e.createCommentVNode("",!0),a.value?(e.openBlock(),e.createElementBlock("div",{key:3,class:"vue-treeselect__control-arrow-container",onMousedown:e.withModifiers(p,["left","stop","prevent"])},[e.createVNode(De,{class:e.normalizeClass({"vue-treeselect__control-arrow":!0,"vue-treeselect__control-arrow--rotated":e.unref(t).menu.isOpen})},null,8,["class"])],32)):e.createCommentVNode("",!0)],32))}}),G=process.env.NODE_ENV==="production"?z.noop:function(t,o){if(!t()){const a=["[Vue-Treeselect Warning]"].concat(o());console.error(...a)}};function St(n,t){const o=n.getBoundingClientRect(),a=t.getBoundingClientRect(),l=t.offsetHeight/3;a.bottom+l>o.bottom?n.scrollTop=Math.min(t.offsetTop+t.clientHeight-n.offsetHeight+l,n.scrollHeight):a.top-l<o.top&&(n.scrollTop=Math.max(t.offsetTop-l,0))}var Nt=function(n,t){var o=document.createElement("_"),a=o.appendChild(document.createElement("_")),l=o.appendChild(document.createElement("_")),p=a.appendChild(document.createElement("_")),m=void 0,_=void 0;return a.style.cssText=o.style.cssText="height:100%;left:0;opacity:0;overflow:hidden;pointer-events:none;position:absolute;top:0;transition:0s;width:100%;z-index:-1",p.style.cssText=l.style.cssText="display:block;height:100%;transition:0s;width:100%",p.style.width=p.style.height="200%",n.appendChild(o),E(),N;function E(){D();var C=n.offsetWidth,b=n.offsetHeight;(C!==m||b!==_)&&(m=C,_=b,l.style.width=C*2+"px",l.style.height=b*2+"px",o.scrollLeft=o.scrollWidth,o.scrollTop=o.scrollHeight,a.scrollLeft=a.scrollWidth,a.scrollTop=a.scrollHeight,t({width:C,height:b})),a.addEventListener("scroll",E),o.addEventListener("scroll",E)}function D(){a.removeEventListener("scroll",E),o.removeEventListener("scroll",E)}function N(){D(),n.removeChild(o)}};function je(n,t){const o=n.indexOf(t);o!==-1&&n.splice(o,1)}let Oe;const he=[],Ct=100;function bt(){Oe=setInterval(()=>{he.forEach(Qe)},Ct)}function xt(){clearInterval(Oe),Oe=null}function Qe(n){const{$el:t,listener:o,lastWidth:a,lastHeight:l}=n,p=t.offsetWidth,m=t.offsetHeight;(a!==p||l!==m)&&(n.lastWidth=p,n.lastHeight=m,o({width:p,height:m}))}function Dt(n,t){const o={$el:n,listener:t,lastWidth:null,lastHeight:null},a=()=>{je(he,o),he.length||xt()};return he.push(o),Qe(o),bt(),a}function Lt(n,t){const o=document.documentMode===9;let a=!0;const m=(o?Dt:Nt)(n,(..._)=>a||t(..._));return a=!1,m}function Vt(n){const t=[];let o=n.parentNode;for(;o&&o.nodeName!=="BODY"&&o.nodeType===document.ELEMENT_NODE;)Tt(o)&&t.push(o),o=o.parentNode;return t.push(window),t}function Tt(n){const{overflow:t,overflowX:o,overflowY:a}=getComputedStyle(n);return/(auto|scroll|overlay)/.test(t+a+o)}function Mt(n,t){const o=Vt(n);return window.addEventListener("resize",t,{passive:!0}),o.forEach(a=>{a.addEventListener("scroll",t,{passive:!0})}),function(){window.removeEventListener("resize",t,{passive:!0}),o.forEach(l=>{l.removeEventListener("scroll",t,{passive:!0})})}}const U=()=>Object.create(null);function we(n,t){if(n.length!==t.length)return!0;for(let o=0;o<n.length;o++)if(n[o]!==t[o])return!0;return!1}const Rt={class:"vue-treeselect__icon-container"},j=e.defineComponent({__name:"TreeselectTip",props:{type:{type:String,required:!0},icon:{type:String,required:!0}},setup(n){return(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(`vue-treeselect__tip vue-treeselect__${n.type}-tip`)},[e.createElementVNode("div",Rt,[e.createElementVNode("span",{class:e.normalizeClass(`vue-treeselect__icon-${n.icon}`)},null,2)]),e.createElementVNode("span",{class:e.normalizeClass(`vue-treeselect__tip-text vue-treeselect__${n.type}-tip-text`)},[e.renderSlot(t.$slots,"default")],2)],2))}}),At=["data-id"],It={key:1,class:"vue-treeselect__option-arrow-placeholder"},$t={key:0,class:"vue-treeselect__checkbox-container"},Ft=[e.createElementVNode("span",{class:"vue-treeselect__check-mark"},null,-1),e.createElementVNode("span",{class:"vue-treeselect__minus-mark"},null,-1)],zt={key:2,class:"vue-treeselect__label"},Ht={key:0,class:"vue-treeselect__count"},Pt={key:0,class:"vue-treeselect__list"},Se=e.defineComponent({__name:"TreeselectOption",props:{node:{}},setup(n){const t=n,o=Y(K),a=e.computed(()=>t.node.isBranch&&o.shouldExpand(t.node)),l=e.computed(()=>o.shouldShowOptionInMenu(t.node)),p=e.computed(()=>o.localSearch.active&&o.props.flattenSearchResults),m=e.computed(()=>o.forest.normalizedOptions.some(y=>y.isBranch)),_=e.computed(()=>p.value?0:t.node.level),E=e.computed(()=>o.props.showCountOnSearch?o.props.showCountOnSearch:o.props.showCount),D=()=>{o.setCurrentHighlightedOption(t.node,!1)},N=()=>{o.toggleExpanded(t.node)},C=()=>{t.node.isBranch&&o.props.disableBranchNodes?o.toggleExpanded(t.node):o.select(t.node)},b=()=>{o.loadChildrenOptions(t.node)},V=e.computed(()=>({"vue-treeselect__list-item":!0,[`vue-treeselect__indent-level-${_.value}`]:!0})),f=e.computed(()=>({"vue-treeselect__option":!0,"vue-treeselect__option--disabled":t.node.isDisabled,"vue-treeselect__option--selected":o.isSelected(t.node),"vue-treeselect__option--highlight":t.node.isHighlighted,"vue-treeselect__option--matched":o.localSearch.active&&t.node.isMatched,"vue-treeselect__option--hide":!l.value})),h=e.computed(()=>o.forest.checkedStateMap[t.node.id]),i=e.computed(()=>({"vue-treeselect__checkbox":!0,"vue-treeselect__checkbox--checked":h.value===Te,"vue-treeselect__checkbox--indeterminate":h.value===Ve,"vue-treeselect__checkbox--unchecked":h.value===ge,"vue-treeselect__checkbox--disabled":t.node.isDisabled})),d=e.computed(()=>t.node.isBranch&&(o.localSearch.active?E:o.props.showCount)),c=e.computed(()=>d.value?o.localSearch.active?o.localSearch.countMap[t.node.id][o.props.showCountOf]:t.node.count[o.props.showCountOf]:NaN),w=e.computed(()=>o.customLabelRenderer);return(y,O)=>{const A=e.resolveComponent("treeselect-option",!0);return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(V.value)},[e.createElementVNode("div",{class:e.normalizeClass(f.value),"data-id":y.node.id,onMouseenter:e.withModifiers(D,["self"])},[!(p.value&&l.value)&&y.node.isBranch?(e.openBlock(),e.createElementBlock("div",{key:0,class:"vue-treeselect__option-arrow-container",onMousedown:e.withModifiers(N,["left","stop","prevent"])},[e.createVNode(e.Transition,{name:"vue-treeselect__option-arrow--prepare",appear:!0},{default:e.withCtx(()=>[e.createVNode(De,{class:e.normalizeClass({"vue-treeselect__option-arrow":!0,"vue-treeselect__option-arrow--rotated":a.value})},null,8,["class"])]),_:1})],32)):m.value?(e.openBlock(),e.createElementBlock("div",It,"   ")):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"vue-treeselect__label-container",onMousedown:e.withModifiers(C,["left","stop","prevent"])},[e.unref(o).props.multiple&&!(e.unref(o).props.disableBranchNodes&&y.node.isBranch)?(e.openBlock(),e.createElementBlock("div",$t,[e.createElementVNode("span",{class:e.normalizeClass(i.value)},Ft,2)])):e.createCommentVNode("",!0),w.value?(e.openBlock(),e.createBlock(le,{key:1,"slot-function":w.value,"slot-object":{node:y.node,shouldShowCount:d.value,count:c.value,labelClassName:"vue-treeselect__label",countClassName:"vue-treeselect__count"}},null,8,["slot-function","slot-object"])):(e.openBlock(),e.createElementBlock("label",zt,[e.createTextVNode(e.toDisplayString(y.node.label)+" ",1),d.value?(e.openBlock(),e.createElementBlock("span",Ht,e.toDisplayString(c.value),1)):e.createCommentVNode("",!0)]))],32)],42,At),y.node.isBranch?(e.openBlock(),e.createBlock(e.Transition,{key:0,name:"vue-treeselect__list--transition"},{default:e.withCtx(()=>{var P;return[a.value?(e.openBlock(),e.createElementBlock("div",Pt,[y.node.childrenStates.isLoaded?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(y.node.children,Q=>(e.openBlock(),e.createBlock(A,{key:Q.id,node:Q},null,8,["node"]))),128)):e.createCommentVNode("",!0),!y.node.childrenStates.isLoaded||(P=y.node.children)!=null&&P.length?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(j,{key:1,type:"no-children",icon:"warning"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(o).props.noChildrenText),1)]),_:1})),y.node.childrenStates.isLoading?(e.openBlock(),e.createBlock(j,{key:2,type:"loading",icon:"loader"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(o).props.loadingText),1)]),_:1})):e.createCommentVNode("",!0),y.node.childrenStates.loadingError?(e.openBlock(),e.createBlock(j,{key:3,type:"error",icon:"error"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(y.node.childrenStates.loadingError)+" ",1),e.createElementVNode("a",{class:"vue-treeselect__retry",title:"{instance.retryTitle}",onMousedown:e.withModifiers(b,["left","stop","prevent"])},e.toDisplayString(e.unref(o).props.retryText),33)]),_:1})):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)]}),_:1})):e.createCommentVNode("",!0)],2)}}}),Wt=["title"],jt={key:4,class:"vue-treeselect__list"},Qt=["title"],Ut={key:4,class:"vue-treeselect__list"},qt=["title"],Kt={key:3,class:"vue-treeselect__list"},Yt=e.defineComponent({__name:"TreeselectMenu",setup(n){const t=Y(K),o={top:"top",bottom:"bottom",above:"top",below:"bottom"},a=e.computed(()=>t.props.appendToBody?"":{zIndex:t.props.zIndex}),l=e.computed(()=>t.beforeListRenderer),p=e.computed(()=>t.afterListRenderer),m=e.computed(()=>t.getRemoteSearchEntry()),_=e.computed(()=>t.trigger.searchQuery===""&&!t.props.defaultOptions),E=e.computed(()=>m.value.options),D=e.computed(()=>E.value instanceof Array?_.value?!1:m.value.isLoaded&&E.value.length===0:!1),N=e.ref(null),C=e.ref(null),b=()=>{f(),h(),i()},V=()=>{d(),c()},f=()=>{if(!t.menu.isOpen)return;const w=t.getMenuDiv(),y=t.getControlDiv(),O=w==null?void 0:w.getBoundingClientRect(),A=y.getBoundingClientRect(),P=O==null?void 0:O.height,Q=window.innerHeight,X=A.top,s=window.innerHeight-A.bottom,u=A.top>=0&&A.top<=Q||A.top<0&&A.bottom>0,L=s>(P||0)+He,k=X>(P||0)+He;u?t.props.openDirection!=="auto"?t.menu.placement=z.get(o,t.props.openDirection):L||!k?t.menu.placement="bottom":t.menu.placement="top":t.closeMenu()},h=()=>{const w=t.getMenuDiv();N.value||(N.value={remove:Lt(w,f)})},i=()=>{const w=t.getControlDiv();C.value||(C.value={remove:Mt(w,f)})},d=()=>{N.value&&(N.value.remove(),N.value=null)},c=()=>{C.value&&(C.value.remove(),C.value=null)};return e.watch(()=>t.menu.isOpen,w=>{w?e.nextTick(b):V()}),e.onMounted(()=>{t.menu.isOpen&&e.nextTick(b)}),e.onUnmounted(()=>{V()}),(w,y)=>(e.openBlock(),e.createElementBlock("div",{ref:"menu-container",class:"vue-treeselect__menu-container",style:e.normalizeStyle(a.value)},[e.createVNode(e.Transition,{name:"vue-treeselect__menu--transition"},{default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("div",{ref:"menu",class:"vue-treeselect__menu",style:e.normalizeStyle({maxHeight:e.unref(t).props.maxHeight+"px"}),onMousedown:y[3]||(y[3]=e.withModifiers((...O)=>e.unref(t).handleMouseDown&&e.unref(t).handleMouseDown(...O),["left","stop","prevent"]))},[l.value?(e.openBlock(),e.createBlock(le,{key:0,"slot-function":l.value},null,8,["slot-function"])):e.createCommentVNode("",!0),e.unref(t).props.async?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[_.value?(e.openBlock(),e.createBlock(j,{key:0,type:"search-prompt",icon:"warning"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t).props.searchPromptText),1)]),_:1})):m.value.isLoading?(e.openBlock(),e.createBlock(j,{key:1,type:"loading",icon:"loader"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t).props.loadingText),1)]),_:1})):m.value.loadingError?(e.openBlock(),e.createBlock(j,{key:2,type:"error",icon:"error"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.value.loadingError)+" ",1),e.createElementVNode("a",{class:"vue-treeselect__retry",title:e.unref(t).props.retryTitle,onClick:y[0]||(y[0]=(...O)=>e.unref(t).handleRemoteSearch&&e.unref(t).handleRemoteSearch(...O))},e.toDisplayString(e.unref(t).props.retryText),9,Wt)]),_:1})):D.value?(e.openBlock(),e.createBlock(j,{key:3,type:"no-results",icon:"warning"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t).props.noResultsText),1)]),_:1})):(e.openBlock(),e.createElementBlock("div",jt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t).forest.normalizedOptions,O=>(e.openBlock(),e.createBlock(Se,{key:O.id,node:O},null,8,["node"]))),128))]))],64)):e.unref(t).localSearch.active?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[e.unref(t).rootOptionsStates.isLoading?(e.openBlock(),e.createBlock(j,{key:0,type:"loading",icon:"loader"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t).props.loadingText),1)]),_:1})):e.unref(t).rootOptionsStates.loadingError?(e.openBlock(),e.createBlock(j,{key:1,type:"error",icon:"error"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t).rootOptionsStates.loadingError)+" ",1),e.createElementVNode("a",{class:"vue-treeselect__retry",title:e.unref(t).props.retryTitle,onClick:y[1]||(y[1]=(...O)=>e.unref(t).loadRootOptions&&e.unref(t).loadRootOptions(...O))},e.toDisplayString(e.unref(t).props.retryText),9,Qt)]),_:1})):e.unref(t).rootOptionsStates.isLoaded&&e.unref(t).forest.normalizedOptions.length===0?(e.openBlock(),e.createBlock(j,{key:2,type:"no-options",icon:"warning"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t).props.noOptionsText),1)]),_:1})):e.unref(t).localSearch.noResults?(e.openBlock(),e.createBlock(j,{key:3,type:"no-results",icon:"warning"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t).props.noResultsText),1)]),_:1})):(e.openBlock(),e.createElementBlock("div",Ut,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t).forest.normalizedOptions,O=>(e.openBlock(),e.createBlock(Se,{key:O.id,node:O},null,8,["node"]))),128))]))],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:3},[e.unref(t).rootOptionsStates.isLoading?(e.openBlock(),e.createBlock(j,{key:0,type:"loading",icon:"loader"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t).props.loadingText),1)]),_:1})):e.unref(t).rootOptionsStates.loadingError?(e.openBlock(),e.createBlock(j,{key:1,type:"error",icon:"error"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t).rootOptionsStates.loadingError)+" ",1),e.createElementVNode("a",{class:"vue-treeselect__retry",title:e.unref(t).props.retryTitle,onClick:y[2]||(y[2]=(...O)=>e.unref(t).loadRootOptions&&e.unref(t).loadRootOptions(...O))},e.toDisplayString(e.unref(t).props.retryText),9,qt)]),_:1})):e.unref(t).rootOptionsStates.isLoaded&&e.unref(t).forest.normalizedOptions.length===0?(e.openBlock(),e.createBlock(j,{key:2,type:"no-options",icon:"warning"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t).props.noOptionsText),1)]),_:1})):(e.openBlock(),e.createElementBlock("div",Kt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t).forest.normalizedOptions,O=>(e.openBlock(),e.createBlock(Se,{key:O.id,node:O},null,8,["node"]))),128))]))],64)),p.value?(e.openBlock(),e.createBlock(le,{key:4,"slot-function":p.value},null,8,["slot-function"])):e.createCommentVNode("",!0)],36),[[e.vShow,e.unref(t).menu.isOpen]])]),_:1})],4))}}),Xt=e.ref(0),Gt={allowClearingDisabled:{type:Boolean,default:!1},allowSelectingDisabledDescendants:{type:Boolean,default:!1},alwaysOpen:{type:Boolean,default:!1},appendToBody:{type:Boolean,default:!1},async:{type:Boolean,default:!1},autoFocus:{type:Boolean,default:!1},autoLoadRootOptions:{type:Boolean,default:!0},autoDeselectAncestors:{type:Boolean,default:!1},autoDeselectDescendants:{type:Boolean,default:!1},autoSelectAncestors:{type:Boolean,default:!1},autoSelectDescendants:{type:Boolean,default:!1},backspaceRemoves:{type:Boolean,default:!0},beforeClearAll:{type:Function,default:z.constant(!0)},branchNodesFirst:{type:Boolean,default:!1},cacheOptions:{type:Boolean,default:!0},clearable:{type:Boolean,default:!0},clearAllText:{type:String,default:"Clear all"},clearOnSelect:{type:Boolean,default:!1},clearValueText:{type:String,default:"Clear value"},closeOnSelect:{type:Boolean,default:!0},defaultExpandLevel:{type:Number,default:0},defaultOptions:{type:Object,default:new Boolean(!1)},deleteRemoves:{type:Boolean,default:!0},delimiter:{type:String,default:","},flattenSearchResults:{type:Boolean,default:!1},disableBranchNodes:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},disableFuzzyMatching:{type:Boolean,default:!1},flat:{type:Boolean,default:!1},instanceId:{default:()=>`${Xt.value++}$$`,type:[String,Number]},joinValues:{type:Boolean,default:!1},limit:{type:Number,default:1/0},limitText:{type:Function,default:function(t){return`and ${t} more`}},loadingText:{type:String,default:"Loading..."},loadOptions:{type:Function},matchKeys:{type:Object,default:z.constant(["label"])},maxHeight:{type:Number,default:300},multiple:{type:Boolean,default:!1},name:{type:String},noChildrenText:{type:String,default:"No sub-options."},noOptionsText:{type:String,default:"No options available."},noResultsText:{type:String,default:"No results found..."},normalizer:{type:Function,default:z.identity},openDirection:{type:String,default:"auto",validator:n=>["auto","top","bottom","above","below"].includes(n)},openOnClick:{type:Boolean,default:!0},openOnFocus:{type:Boolean,default:!1},options:{type:Array},placeholder:{type:String,default:"Select..."},required:{type:Boolean,default:!1},retryText:{type:String,default:"Retry?"},retryTitle:{type:String,default:"Click to retry"},searchable:{type:Boolean,default:!0},searchNested:{type:Boolean,default:!1},searchPromptText:{type:String,default:"Type to search..."},showCount:{type:Boolean,default:!1},showCountOf:{type:String,default:v,validator:n=>[v,se,re,ae].includes(n)},showCountOnSearch:{type:Boolean,default:!1},sortValueBy:{type:String,default:Ie,validator:n=>[Ie,$e,Fe].includes(n)},tabIndex:{type:Number,default:0},modelValue:null,valueConsistsOf:{type:String,default:fe,validator(n){return[Ee,fe,ke,Be].includes(n)}},valueFormat:{type:String,default:"id"},zIndex:{type:[Number,String],default:999}};class Jt{constructor(){W(this,"normalizedOptions",new Array);W(this,"nodeMap",U());W(this,"checkedStateMap",U());W(this,"selectedNodeIds",new Array);W(this,"selectedNodeMap",U())}}class Zt{constructor(){W(this,"active",!1);W(this,"noResults",!0);W(this,"countMap",U())}}const vt={isLoaded:!1,isLoading:!1,loadingError:""};class en{constructor(){W(this,"isOpen",!1);W(this,"current",null);W(this,"lastScrollPosition",0);W(this,"placement","bottom")}}class tn{constructor(){W(this,"isFocused",!1);W(this,"searchQuery","")}}const Ue=(n,t)=>{const o=a=>{var l;(l=a==null?void 0:a.children)==null||l.forEach(p=>{n(p)!==!1&&p.isBranch&&o(p)})};o({children:t})},nn=n=>{G(()=>n.async?n.searchable:!0,()=>'For async search mode, the value of "searchable" prop must be true.'),n.options==null&&!n.loadOptions&&G(()=>!1,()=>'Are you meant to dynamically load options? You need to use "loadOptions" prop.'),n.flat&&G(()=>n.multiple,()=>'You are using flat mode. But you forgot to add "multiple=true"?'),n.flat||["autoSelectAncestors","autoSelectDescendants","autoDeselectAncestors","autoDeselectDescendants"].forEach(o=>{G(()=>!z.get(n,o),()=>`"${o}" only applies to flat mode.`)})};function on(n,t){return typeof n.level<"u"&&typeof t.level<"u"?n.level===t.level?qe(n,t):n.level-t.level:-1}function qe(n,t){var a,l;let o=0;do{if(!n.level||!t.level||(n==null?void 0:n.level)<o)return-1;if((t==null?void 0:t.level)<o)return 1;if(n.index!=null&&t.index!=null&&n.index[o]!==t.index[o])return((a=n==null?void 0:n.index)==null?void 0:a[o])-((l=t==null?void 0:t.index)==null?void 0:l[o]);o++}while(!0)}function ln(n,t){const o=e.computed(()=>t.selectedNodeIds.map(p).filter(i=>i!==null)),a=e.computed(()=>{let f=[];if(!n.multiple||n.flat||n.disableBranchNodes||n.valueConsistsOf===Ee)f=t.selectedNodeIds.slice();else if(n.valueConsistsOf===fe)f=t.selectedNodeIds.filter(h=>{const i=p(h);return i!=null&&i.isRootNode?!0:!N(i==null?void 0:i.parentNode)});else if(n.valueConsistsOf===ke)f=t.selectedNodeIds.filter(h=>{var d;const i=p(h);return i!=null&&i.isLeaf?!0:((d=i==null?void 0:i.children)==null?void 0:d.length)===0});else if(n.valueConsistsOf===Be){const h=new Array;f=t.selectedNodeIds.slice(),o.value.forEach(i=>{var d;(d=i.ancestors)==null||d.forEach(c=>{h.includes(c.id)||f.includes(c.id)||h.push(c.id)})}),f.push(...h)}return n.sortValueBy===$e?f.sort((h,i)=>{const d=p(h),c=p(i);return d&&c?on(d,c):0}):n.sortValueBy===Fe&&f.sort((h,i)=>{const d=p(h),c=p(i);return d&&c?qe(d,c):0}),f}),l=()=>{if(n.valueFormat==="id")return n.multiple?a.value.slice():a.value[0];const f=a.value.map(h=>{var i;return(i=p(h))==null?void 0:i.raw});return n.multiple?f:f[0]},p=f=>(G(()=>f!=null,()=>`Invalid node id: ${f}`),f==null?null:f in t.nodeMap?t.nodeMap[f]:m(f)),m=f=>{const h=_(f),i=E(h).label||`${f} (unknown)`,d={id:f,label:i,ancestors:[],parentNode:J,isFallbackNode:!0,isRootNode:!0,isLeaf:!0,isBranch:!1,isDisabled:!1,isNew:!1,index:[-1],level:0,raw:h};return t.nodeMap[f]=d},_=f=>{const h={id:f};return n.valueFormat==="id"?h:(n.multiple?Array.isArray(n.modelValue)?n.modelValue:[]:n.modelValue?[n.modelValue]:[]).find(c=>E(c).id===f)||h},E=f=>{var i;const h=(i=n.normalizer)==null?void 0:i.call(n,f,n.instanceId.toString());return h?{...f,...h}:f},D=(f,h)=>{var d;if(!f.isBranch)return;const i=(d=f==null?void 0:f.children)==null?void 0:d.slice();for(;i!=null&&i.length;){const c=i[0];c.isBranch&&c.children&&i.push(...c.children),h(c),i.shift()}},N=f=>f&&t.selectedNodeMap[f.id]===!0,C=()=>{const f=U();t.selectedNodeIds.forEach(i=>{f[i]=!0}),t.selectedNodeMap=f;const h=U();n.multiple&&(Ue(i=>{h[i.id]=ge},t.normalizedOptions),o.value.forEach(i=>{var d;h[i.id]=Te,!n.flat&&!n.disableBranchNodes&&((d=i.ancestors)==null||d.forEach(c=>{N(c)||(h[c.id]=Ve)}))})),t.checkedStateMap=h},b=f=>{t.normalizedOptions.forEach(h=>{V(h,f),f(h)})},V=(f,h)=>{var i;f.isBranch&&((i=f==null?void 0:f.children)==null||i.forEach(d=>{V(d,h),h(d)}))};return{getNode:p,enhancedNormalizer:E,traverseDescendantsBFS:D,buildForestState:C,internalValue:a,isSelected:N,getValue:l,selectedNodes:o,traverseAllNodesDFS:b,traverseDescendantsDFS:V}}function sn(n,t,o,a,l,p){const m=e.computed(()=>E.value.length!==0),_=i=>{var d;return!!(i.isMatched||i.isBranch&&i.hasMatchedDescendants&&!n.flattenSearchResults||!i.isRootNode&&((d=i.parentNode)!=null&&d.showAllChildrenOnSearch))},E=e.computed(()=>{const i=[],d=c=>o.active?c.isExpandedOnSearch:c.isExpanded;return Ue(c=>((!o.active||_(c))&&i.push(c.id),!(c.isBranch&&!d(c))),t.normalizedOptions),i}),D=()=>{if(!m.value)return;const i=E.value[0],d=l(i);d&&h(d)},N=()=>{if(m.value&&a.current){const i=E.value.indexOf(a.current)-1;if(i===-1)return b();const d=l(E.value[i]);d&&h(d)}},C=()=>{if(m.value&&a.current){const i=E.value.indexOf(a.current)+1;if(i===E.value.length)return D();const d=l(E.value[i]);d&&h(d)}},b=()=>{if(!m.value)return;const i=z.last(E.value);if(i!=null){const d=l(i);d&&h(d)}},V=i=>!(o.active&&!_(i)),f=(i=!1)=>{const{current:d}=a,c=d&&l(d);(i||d==null||!(d in t.nodeMap)||c&&!V(c))&&D()},h=(i,d=!0)=>{const c=a.current;if(c!=null&&c in t.nodeMap&&(t.nodeMap[c].isHighlighted=!1),a.current=i.id,i.isHighlighted=!0,a.isOpen&&d){const w=()=>{const y=p(),O=y==null?void 0:y.querySelector(`.vue-treeselect__option[data-id="${i.id}"]`);O&&y&&St(y,O)};p()?w():e.nextTick(w)}};return{resetHighlightedOptionWhenNecessary:f,highlightLastOption:b,highlightFirstOption:D,setCurrentHighlightedOption:h,highlightPrevOption:N,highlightNextOption:C,shouldShowOptionInMenu:V}}function rn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function an(n,t){var o=t.length,a=n.length;if(a>o)return!1;if(a===o)return n===t;e:for(var l=0,p=0;l<a;l++){for(var m=n.charCodeAt(l);p<o;)if(t.charCodeAt(p++)===m)continue e;return!1}return!0}var cn=an;const dn=rn(cn),Ne=n=>n.message||String(n);function un(n){return typeof n=="string"?n:typeof n=="number"?n.toString():""}function Ke(n,t,o){return n?dn(t,o):o.includes(t)}function pn(n,t,o,a,l,p,m,_,E,D,N){const C=U(),b=()=>({...vt}),V=e.reactive(b()),f=({action:s,args:u,isPending:L,start:k,succeed:r,fail:R,end:g})=>{if(!n.loadOptions||L())return;k();const S=z.once((I,Z)=>{I?R(I):r(Z),g()}),x=n.loadOptions({instanceId:n.instanceId,action:s,...u,callback:S});be(x)&&x.then(()=>{S()},I=>{S(I)})},h=()=>{f({action:Me,isPending:()=>V.isLoading,start:()=>{V.isLoading=!0,V.loadingError=""},succeed:()=>{V.isLoaded=!0,e.nextTick(()=>{_(!0)})},fail:s=>{V.loadingError=Ne(s)},end:()=>{V.isLoading=!1}})},i=()=>{const{searchQuery:s}=o,u=C[s]||e.reactive({...b(),options:[]});if(e.watch(()=>u.options,()=>{o.searchQuery===s&&P()},{deep:!0}),s===""){if(Array.isArray(n.defaultOptions))return u.options=n.defaultOptions,u.isLoaded=!0,u;if(n.defaultOptions!==!0)return u.isLoaded=!0,u}return C[s]||(C[s]=u),u},d=s=>{t.selectedNodeIds.forEach(u=>{if(!s[u])return;const L={...s[u],isFallbackNode:!0};t.nodeMap[u]=L})},c=s=>{G(()=>!(s.id in t.nodeMap&&!t.nodeMap[s.id].isFallbackNode),()=>`Detected duplicate presence of node id ${JSON.stringify(s.id)}. Their labels are "${t.nodeMap[s.id].label}" and "${s.label}" respectively.`)},w=s=>{G(()=>!(s.children===void 0&&s.isBranch===!0),()=>"Are you meant to declare an unloaded branch node? `isBranch: true` is no longer supported, please use `children: null` instead.")},y=s=>{const{id:u,raw:L}=s;f({action:Re,args:{parentNode:L},isPending:()=>{var k;return(k=p(u))==null?void 0:k.childrenStates.isLoading},start:()=>{const k=p(u);k&&(k.childrenStates.isLoading=!0,k.childrenStates.loadingError="")},succeed:()=>{const k=p(u);k&&(k.childrenStates.isLoaded=!0)},fail:k=>{const r=p(u);r&&(r.childrenStates.loadingError=Ne(k))},end:()=>{const k=p(u);k&&(k.childrenStates.isLoading=!1)}})},O=s=>{var k,r;let u=[];if(!n.multiple||n.flat||n.disableBranchNodes||n.valueConsistsOf===Ee)u=s;else if(n.valueConsistsOf===fe)s.forEach(R=>{u.push(R);const g=p(R);g!=null&&g.isBranch&&m(g,S=>{u.push(S.id)})});else if(n.valueConsistsOf===ke){const R=U(),g=s.slice();for(;g.length;){const S=g.shift(),x=S&&p(S);if(S&&x){if(u.push(S),x.isRootNode)continue;if(x.parentNode){x.parentNode.id in R||(R[x.parentNode.id]=(k=x.parentNode.children)==null?void 0:k.length);let I=R[x.parentNode.id];I&&--I===0&&g.push(x.parentNode.id)}}}}else if(n.valueConsistsOf===Be){const R=U(),g=s.filter(S=>{var I;const x=p(S);return(x==null?void 0:x.isLeaf)||((I=x==null?void 0:x.children)==null?void 0:I.length)===0});for(;g.length;){const S=g.shift(),x=S&&p(S);if(S&&x){if(u.push(S),x.isRootNode)continue;if(x.parentNode){x.parentNode.id in R||(R[x.parentNode.id]=(r=x.parentNode.children)==null?void 0:r.length);let I=R[x.parentNode.id];I&&--I===0&&g.push(x.parentNode.id)}}}}we(t.selectedNodeIds,u)&&(t.selectedNodeIds=u),D()},A=(s,u,L)=>{let k=u.map(r=>[E(r),r]).map(([r,R],g)=>{var ue,pe,ne;c(r),w(r);const{id:S,label:x,children:I,isDefaultExpanded:Z}=r,q=s===J,ee=q?0:s.level!=null?s.level+1:0,te=Array.isArray(I)||I===null,ie=!te,ce=!!r.isDisabled||!n.flat&&!q&&s.isDisabled,me=!!r.isNew,de=n.matchKeys.reduce((T,oe)=>({...T,[oe]:un(r[oe]).toLocaleLowerCase()}),{}),Ce=q?de.label:s.nestedSearchLabel+" "+de.label;t.nodeMap[S]=U();const B=t.nodeMap[S];if(B.id=S,B.label=x,B.level=ee,B.ancestors=q?[]:(s==null?void 0:s.ancestors)&&[s].concat(s==null?void 0:s.ancestors),B.index=(q?[]:s.index?s.index:[]).concat(g),B.parentNode=s,B.lowerCased=de,B.nestedSearchLabel=Ce,B.isDisabled=ce,B.isNew=me,B.isMatched=!1,B.isHighlighted=!1,B.isBranch=te,B.isLeaf=ie,B.isRootNode=q,B.raw=R,te){const T=Array.isArray(I);B.childrenStates={...b(),isLoaded:T},B.isExpanded=typeof Z=="boolean"?Z:ee<n.defaultExpandLevel,B.hasMatchedDescendants=!1,B.hasDisabledDescendants=!1,B.isExpandedOnSearch=!1,B.showAllChildrenOnSearch=!1,B.count={[v]:0,[se]:0,[re]:0,[ae]:0},B.children=T?A(B,I,L):[],Z===!0&&((ue=B.ancestors)==null||ue.forEach(oe=>{oe.isExpanded=!0})),!T&&typeof n.loadOptions!="function"?G(()=>!1,()=>'Unloaded branch node detected. "loadOptions" prop is required to load its children.'):!T&&B.isExpanded&&y(B)}if((pe=B.ancestors)==null||pe.forEach(T=>T.count[se]++),ie&&((ne=B.ancestors)==null||ne.forEach(T=>T.count[ae]++)),q||(s.count[v]+=1,ie&&(s.count[re]+=1),ce&&(s.hasDisabledDescendants=!0)),L&&L[S]){const T=L[S];B.isMatched=T.isMatched,B.showAllChildrenOnSearch=T.showAllChildrenOnSearch,B.isHighlighted=T.isHighlighted,T.isBranch&&B.isBranch&&(B.isExpanded=T.isExpanded,B.isExpandedOnSearch=T.isExpandedOnSearch,T.childrenStates.isLoaded&&!B.childrenStates.isLoaded?B.isExpanded=!1:B.childrenStates={...T.childrenStates})}return B});if(n.branchNodesFirst){const r=k.filter(g=>g.isBranch),R=k.filter(g=>g.isLeaf);k=r.concat(R)}return k},P=()=>{const s=n.async?i().options:n.options;if(Array.isArray(s)){const u=t.nodeMap;t.nodeMap=U(),d(u),t.normalizedOptions=A(J,s,u),O(a.value)}else t.normalizedOptions=[]};return{handleRemoteSearch:()=>{const{searchQuery:s}=o,u=i(),L=()=>{P(),_(!0)};if((s===""||n.cacheOptions)&&u.isLoaded)return L();f({action:Ae,args:{searchQuery:s},isPending(){return u.isLoading},start:()=>{u.isLoading=!0,u.isLoaded=!1,u.loadingError=""},succeed:k=>{u.isLoaded=!0,u.options=k,o.searchQuery===s&&L()},fail:k=>{u.loadingError=Ne(k)},end:()=>{u.isLoading=!1}})},loadRootOptions:h,loadChildrenOptions:y,getRemoteSearchEntry:i,initialize:P,rootOptionsStates:V,fixSelectedNodeIds:O,handleLocalSearch:()=>{const{searchQuery:s}=o,u=()=>_(!0);if(!s)return l.active=!1,u();l.active=!0,l.noResults=!0,N(r=>{r.isBranch&&(r.isExpandedOnSearch=!1,r.showAllChildrenOnSearch=!1,r.isMatched=!1,r.hasMatchedDescendants=!1,l.countMap[r.id]={[v]:0,[se]:0,[re]:0,[ae]:0})});const L=s.trim().toLocaleLowerCase(),k=L.replace(/\s+/g," ").split(" ");N(r=>{var R,g;n.searchNested&&k.length>1?r.isMatched=k.every(S=>Ke(!1,S,r.nestedSearchLabel)):r.isMatched=n.matchKeys.some(S=>Ke(!n.disableFuzzyMatching,L,r.lowerCased[S])),r.isMatched&&(l.noResults=!1,(R=r.ancestors)==null||R.forEach(S=>l.countMap[S.id][se]++),r.isLeaf&&((g=r.ancestors)==null||g.forEach(S=>l.countMap[S.id][ae]++)),r.parentNode&&r.parentNode!==J&&(l.countMap[r.parentNode.id][v]+=1,r.isLeaf&&(l.countMap[r.parentNode.id][re]+=1))),(r.isMatched||r.isBranch&&r.isExpandedOnSearch)&&r.parentNode&&r.parentNode!==J&&(r.parentNode.isExpandedOnSearch=!0,r.parentNode.hasMatchedDescendants=!0)}),u()}}}function fn(n,t,o,a,l,p,m,_,E,D){const N=()=>{n.disabled||o.isOpen||(o.isOpen=!0,e.nextTick(p),e.nextTick(f),!n.options&&!n.async&&l(),b(!0),t("open",n.instanceId))},C=()=>{!o.isOpen||!n.disabled&&n.alwaysOpen||(h(),o.isOpen=!1,b(!1),E(),t("close",_(),n.instanceId))},b=d=>{d?document.addEventListener("mousedown",V,!1):document.removeEventListener("mousedown",V,!1)},V=d=>{var c;a.value&&!((c=a.value)!=null&&c.contains(d.target))&&(D(),C())},f=()=>{const d=m();d&&(d.scrollTop=o.lastScrollPosition)},h=()=>{const d=m();d&&(o.lastScrollPosition=d.scrollTop)};return{openMenu:N,toggleClickOutsideEvent:b,toggleMenu:()=>{o.isOpen?C():N()},closeMenu:C}}function hn(n,t,o,a,l,p,m,_,E,D,N,C,b,V){const f=e.ref(!1),h=e.computed(()=>l.value.length>0),i=s=>{o.selectedNodeIds.push(s.id),o.selectedNodeMap[s.id]=!0},d=s=>{je(o.selectedNodeIds,s.id),delete o.selectedNodeMap[s.id]},c=()=>{if(!h.value)return;if(!n.multiple)return w();const s=z.last(l.value);if(s!=null){const u=_(s);u&&A(u)}},w=()=>{h.value&&(!n.multiple||n.allowClearingDisabled?o.selectedNodeIds=[]:o.selectedNodeIds=o.selectedNodeIds.filter(s=>{var u;return(u=_(s))==null?void 0:u.isDisabled}),E())},y=s=>{var L,k;if(!n.multiple||n.disableBranchNodes)return i(s);if(n.flat){i(s),n.autoSelectAncestors?(L=s.ancestors)==null||L.forEach(r=>{!D(r)&&!r.isDisabled&&i(r)}):n.autoSelectDescendants&&N(s,r=>{!D(r)&&!r.isDisabled&&i(r)});return}const u=s.isLeaf||!s.hasDisabledDescendants||n.allowSelectingDisabledDescendants;if(u&&i(s),s.isBranch&&N(s,r=>{(!r.isDisabled||n.allowSelectingDisabledDescendants)&&i(r)}),u){let r=s;for(;(r=r==null?void 0:r.parentNode)!==J&&((k=r==null?void 0:r.children)!=null&&k.every(D));)i(r)}},O=s=>{var L,k;if(n.disableBranchNodes)return d(s);if(n.flat){d(s),n.autoDeselectAncestors?(L=s.ancestors)==null||L.forEach(r=>{D(r)&&!r.isDisabled&&d(r)}):n.autoDeselectDescendants&&N(s,r=>{D(r)&&!r.isDisabled&&d(r)});return}let u=!1;if(s.isBranch&&V(s,r=>{(!r.isDisabled||n.allowSelectingDisabledDescendants)&&(d(r),u=!0)}),s.isLeaf||u||((k=s.children)==null?void 0:k.length)===0){d(s);let r=s;for(;(r=r.parentNode?r.parentNode:null)!==J&&D(r);)d(r)}},A=s=>{if(n.disabled||s.isDisabled)return;n.multiple||w();const u=n.multiple&&!n.flat?o.checkedStateMap[s.id]===ge:!D(s);u?y(s):O(s),E(),t(u?"select":"deselect",s.raw,n.instanceId),a.active&&u&&(!n.multiple||n.clearOnSelect)&&m(),!n.multiple&&n.closeOnSelect&&(p(),n.searchable&&(f.value=!0))};return{clear:w,hasValue:h,removeLastValue:c,select:A,shouldExpand:s=>a.active?s.isExpandedOnSearch:s.isExpanded,toggleExpanded:s=>{let u;a.active?(u=s.isExpandedOnSearch=!s.isExpandedOnSearch,u&&(s.showAllChildrenOnSearch=!0)):u=s.isExpanded=!s.isExpanded,u&&!s.childrenStates.isLoaded&&C(s)},blurOnSelect:f,extractCheckedNodeIdsFromValue:()=>n.modelValue==null?[]:n.valueFormat==="id"?n.multiple?n.modelValue.slice():[n.modelValue]:(n.multiple?n.modelValue:[n.modelValue]).map(s=>b(s)).map(s=>s.id)}}const mn=e.defineComponent({__name:"Treeselect",props:Gt,emits:["select","deselect","close","open","update:modelValue","search-change"],setup(n,{emit:t}){const o=n;nn(o);const a=t,l=e.ref(),p=e.reactive(new Jt),m=e.reactive(new tn),_=e.reactive(new en),E=e.ref(),D=e.ref(),N=e.reactive(new Zt),C=e.computed(()=>({"vue-treeselect":!0,"vue-treeselect--single":!o.multiple,"vue-treeselect--multi":o.multiple,"vue-treeselect--searchable":o.searchable,"vue-treeselect--disabled":o.disabled,"vue-treeselect--focused":m.isFocused,"vue-treeselect--has-value":Ye.value,"vue-treeselect--open":_.isOpen,"vue-treeselect--open-above":_.placement==="top","vue-treeselect--open-below":_.placement==="bottom","vue-treeselect--branch-nodes-disabled":o.disableBranchNodes,"vue-treeselect--append-to-body":o.appendToBody})),b=e.useSlots(),V=b["before-list"],f=b["after-list"],h=b["value-label"],i=b["option-label"],d=()=>{var $;const M=($=E.value)==null?void 0:$.$refs.menu;return M&&M.nodeName!=="#comment"?M:null},c=()=>{var M;return(M=l.value)==null?void 0:M.$el},w=()=>{m.searchQuery=""},{getNode:y,internalValue:O,traverseDescendantsBFS:A,enhancedNormalizer:P,buildForestState:Q,isSelected:X,getValue:s,selectedNodes:u,traverseAllNodesDFS:L,traverseDescendantsDFS:k}=ln(o,p),{resetHighlightedOptionWhenNecessary:r,highlightLastOption:R,highlightFirstOption:g,setCurrentHighlightedOption:S,highlightPrevOption:x,highlightNextOption:I,shouldShowOptionInMenu:Z}=sn(o,p,N,_,y,d),{handleRemoteSearch:q,loadRootOptions:ee,loadChildrenOptions:te,getRemoteSearchEntry:ie,initialize:ce,rootOptionsStates:me,fixSelectedNodeIds:de,handleLocalSearch:Ce}=pn(o,p,m,O,N,y,A,r,P,Q,L),B=()=>{var M;return(M=l.value)==null?void 0:M.$refs["value-container"]},ue=()=>B().$refs.input,pe=()=>{ue().blur()},ne=()=>{ue().focus()},{openMenu:T,toggleClickOutsideEvent:oe,toggleMenu:_n,closeMenu:_e}=fn(o,a,_,D,ee,r,d,s,w,pe),{clear:yn,hasValue:Ye,removeLastValue:gn,select:En,shouldExpand:kn,toggleExpanded:Bn,blurOnSelect:Xe,extractCheckedNodeIdsFromValue:On}=hn(o,a,p,N,O,_e,w,y,Q,X,A,te,P,k),wn=M=>{if(o.disabled)return;B().$el.contains(M.target)&&!_.isOpen&&(o.openOnClick||m.isFocused)&&T(),Xe.value?pe():ne(),Xe.value=!1},Sn=e.computed(()=>{var M;if(o.appendToBody){const $=(M=c())==null?void 0:M.getBoundingClientRect(),Ge=_.placement==="bottom"?$==null?void 0:$.height:0;return{left:Math.round($==null?void 0:$.left)+"px",top:Math.round(($==null?void 0:$.top)+Ge)+"px",width:($==null?void 0:$.width)+"px"}}return""});return e.provide(K,{props:o,hasValue:Ye,internalValue:O,menu:_,trigger:m,clear:yn,getNode:y,focusInput:ne,toggleMenu:_n,openMenu:T,getMenuDiv:d,closeMenu:_e,removeLastValue:gn,select:En,highlightLastOption:R,highlightFirstOption:g,shouldExpand:kn,setCurrentHighlightedOption:S,loadChildrenOptions:te,toggleExpanded:Bn,highlightPrevOption:x,highlightNextOption:I,localSearch:N,getControlDiv:c,getRemoteSearchEntry:ie,handleRemoteSearch:q,forest:p,handleMouseDown:wn,beforeListRenderer:V,afterListRenderer:f,customValueLabelRenderer:h,isSelected:X,shouldShowOptionInMenu:Z,customLabelRenderer:i,selectedNodes:u,rootOptionsStates:me,loadRootOptions:ee}),e.watch(()=>o.alwaysOpen,()=>{o.alwaysOpen?T():_e()}),e.watch(()=>o.multiple,()=>{o.multiple&&Q()}),e.watch(()=>z.cloneDeep(o.options),()=>{o.async||(ce(),me.isLoaded=Array.isArray(o.options))},{deep:!0,immediate:!0}),e.watch(()=>m.searchQuery,()=>{o.async?q():Ce(),a("search-change",m.searchQuery,o.instanceId)}),e.watch(()=>o.modelValue,()=>{const M=On();we(M,O.value)&&de(M)},{immediate:!0}),e.watch(()=>o.disabled,M=>{M&&_.isOpen?_e():!M&&!_.isOpen&&o.alwaysOpen&&T()}),e.watch([()=>o.flat,()=>o.branchNodesFirst,()=>o.matchKeys],()=>{ce()}),e.watch(O,(M,$)=>{we(M,$)&&a("update:modelValue",s(),o.instanceId)},{deep:!0}),e.onMounted(()=>{o.autoFocus&&ne(),!o.options&&!o.async&&o.autoLoadRootOptions&&ee(),o.alwaysOpen&&T(),o.async&&o.defaultOptions&&q()}),e.onUnmounted(()=>{oe(!1)}),(M,$)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"wrapper",ref:D,class:e.normalizeClass(C.value)},[e.createVNode(Ze),e.createVNode(wt,{ref_key:"control",ref:l},null,512),(e.openBlock(),e.createBlock(e.Teleport,{to:"body",disabled:!o.appendToBody},[e.createVNode(Yt,{ref_key:"menuRef",ref:E,class:e.normalizeClass(M.appendToBody?C.value:""),style:e.normalizeStyle(Sn.value)},null,8,["class","style"])],8,["disabled"]))],2))}});F.ASYNC_SEARCH=Ae,F.LOAD_CHILDREN_OPTIONS=Re,F.LOAD_ROOT_OPTIONS=Me,F.default=mn,Object.defineProperties(F,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
